---
title: "Exploratory Data Analysis of ISPARK Dataset"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggplot2)
library(lubridate)
parkinformations <- readRDS("ispark-parkbilgileri.RDS") %>% select(-c(Distance,BosKapasite))
parkcapacitylog <- readRDS("parkcapacitylog.RDS")
```

# Dataset

We have two tables in our dataset. First table contains informations about ISPARK park areas. Second table contains hourly percentage of occupancies of these park areas between 19 November 2020 and 2 December 2020. We have collected this datas by using IBB OpenData API. You can also access this API from [here.](https://api.ibb.gov.tr/ispark/Park)

### Park Informations Table

Park Informations table contains 9 variables and 577 observations. Descriptions of columns is below.

* `ParkID`: Unique identifier of the parking place
* `ParkAdi`: Name of the parking place
* `Latitude`: Latitude of the parking place
* `Longitude`: Longitude of the parking place
* `Kapasitesi`: Full capacity of the parking space when it is empty
* `ParkTipi`: Types of parking ways of the parking space; Yolüstü – Acik-- Kapali
* `Ilce`: District which parking space in
* `UcretsizParklanmaDk`:Free parking duration in minutes
* `AylıkAbonelikUcreti`:Monthly subscription fee (₺)

```{r parkinfosum}
summary(parkinformations)
```



### Hourly Percentage of Occupancy Table

Hourly Percentage of Occupancy table contains 4 variables and `r nrow(parkcapacitylog)` observations. Descriptions of columns is below.

* `ParkID`: Unique identifier of the parking place
* `ParkAdi`: Name of the parking place
* `DolulukYuzdesi`: Percentage of occupancy
* `OlcumZamanı`: Observation date and time


```{r parkcapsum}
summary(parkcapacitylog)
```

# Missing Values

We don't have any missing values in our tables as you can see below. We think this is because we use API data that is cleaned and submitted by others.

Missing values in Park Informations table by variable

```{r}
sapply(parkinformations, function(x) sum(is.na(x)))
```

Missing values in Hourly Percentage of Occupancy table by variable

```{r}
sapply(parkcapacitylog, function(x) sum(is.na(x)))
```

```{r}
parkinformations %>% filter(ParkTipi %in% c("AÇIK OTOPARK","KAPALI OTOPARK","YOL ÜSTÜ")) %>% ggplot(., aes(ParkTipi,AylıkAbonelikÜcreti)) +
  geom_boxplot()
```

```{r}
park_capacity_hourly <- parkcapacitylog %>%
  group_by(hour = lubridate::hour(OlcumZamanı)) %>%
  summarize( avd_doluluk_orani =mean(DolulukYuzdesi))
ggplot(park_capacity_hourly, aes(hour, avd_doluluk_orani)) +
  geom_line() +
  labs(x="Hour", y="Average Occupancy Rate") +
  labs(title = "Average Hourly Parking Occupancy Rate in Istanbul")
```

In this line graph, average parking occupancy rate during daytime is less than nights. Parking occupancy rate is starting to decrease when working hours started and continue to decrease until approximately 15:00 pm. and it sharply increases by closing hours of working day. The graph shows that 'İspark' stations in Istanbul mostly used during nights.

```{r}
mergedtable <- merge(x = parkcapacitylog, y = parkinformations, by = "ParkID", all.x = TRUE)
merged_park_capacity_hourly <- mergedtable %>%
  group_by(hour = lubridate::hour(OlcumZamanı), ParkTipi) %>%
  summarize( avd_doluluk_orani =mean(DolulukYuzdesi)) %>% filter(ParkTipi != "NA")
ggplot(merged_park_capacity_hourly, aes(hour, avd_doluluk_orani, color=ParkTipi)) +
  geom_line() +
  labs(x="Hour", y="Average Occupancy Rate") +
  labs(title = "Hourly Parking Occupancy Rate by Park Type in Istanbul")
```

In all park types, the average occupancy rate decreases during daytime In Istanbul. In average, it is more probably that chance to find empty parking space in parking garage than open parking lots and parking lots near road.  

```{r message=FALSE, warning=FALSE}
parkinfo_tip <- parkinformations %>% group_by(ParkTipi) %>% summarize("Toplam Kapasite"=sum(Kapasitesi), "Ortalama Kapatise"=mean(Kapasitesi), "Ortalama Ücretsiz Park Süresi" = mean(UcretsizParklanmaDk), "Ortalama Aylık Ücret" = mean(AylıkAbonelikÜcreti))
parktipi_adet <- parkinformations %>% group_by(ParkTipi) %>% count(ParkTipi, sort = TRUE)
#parkinfo_tip %>% left_join(parktipi_adet) 
parktipi_adet %>% left_join(parkinfo_tip) %>% rename("Park Adeti"=n) 
```

```{r}
parktipi_adet <- parkinformations %>% group_by(ParkTipi) %>% count(ParkTipi, sort = TRUE)

```

```{r}
ggplot(parkinformations, aes(x=AylıkAbonelikÜcreti, fill=ParkTipi))+
  geom_histogram(bins = 6, binwidth = 100)+
  labs(title="Price Histogram",x ="Price", y = "Count")
```

